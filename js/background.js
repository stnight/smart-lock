var chRt,chSt,chTb,isLocked,password,tabsCommander,userMessage;chTb=chrome.tabs,chRt=chrome.runtime,chSt=chrome.storage.sync,password=null,isLocked=chSt.get(null,function(e){return e.isLocked}),userMessage=chSt.get(null,function(e){return e.userMessage}),tabsCommander=function(e,s){var n;switch(null==s&&(s=null),n={},e){case"lockEverything":n.cmd="lock-everything";break;case"noPassword":n.cmd="no-password";break;case"unlockAttempt":n.cmd="unlock-attempt",n.result=s;break;case"unlockAll":n.cmd="unlock-all"}return chTb.query({},function(e){e.forEach(function(e){return chTb.connect(e.id),chTb.sendMessage(e.id,n)})})},chRt.onMessage.addListener(function(e,s,n){"lockBrowser"===e.greetings&&(seeAll(),n({reply:"ok wait"}))}),chRt.onMessage.addListener(function(e,s,n){switch(e.cmd){case"check-lock":return n({reply:isLocked});case"lock-browser":return chSt.get(null,function(e){null!==e.password&&"undefined"!=typeof e.password&&""!==e.password?(chSt.set({isLocked:!0},function(){}),isLocked=!0,tabsCommander("lockEverything")):(""===e.password||null===e.password||"undefined"==typeof e.password)&&tabsCommander("noPassword")}),n({reply:"done with the commands"});case"validate-password":return chSt.get(null,function(s){e.password===s.password?(tabsCommander("unlockAttempt",!0),isLocked=!1,chSt.set({isLocked:!1},function(){})):tabsCommander("unlockAttempt",!1)});case"all-no-password":return tabsCommander("unlockAll")}}),chrome.storage.onChanged.addListener(function(e,s){return isLocked=chSt.get(null,function(e){e.isLocked})});